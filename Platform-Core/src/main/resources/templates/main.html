<!DOCTYPE html>
<html lang="zh_CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title th:text="${platformName}">管理平台</title>
    <link rel="icon" type="image/x-icon" href="/image/icon.ico">

    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/font-awesome-4.7.0/css/font-awesome.min.css">
    <style type="text/css">

        .light-line-left {
            width: 3px;
            height: 0;
            background-color: #0e90ce;
            margin: auto 0;
        }

        .light-line-bottom-div {
            position: absolute;
            height: 3px;
            width: 100%;
            bottom: 0;
        }

        .light-line-bottom {
            width: 0;
            height: 100%;
            background-color: #0e90ce;
            margin: 0 auto;
        }

        .main-body {
            height: 100%;
            display: flex;
        }

        .navigate {
            display: inline-block;
            background-color: #252a2f;
            color: #ffffff;
            height: 100%;
            width: 10rem;
        }

        .navigate-user {
            text-align: center;
            border-bottom: 1px solid #e8e8e8;
            padding: 2rem 0;
        }

        .navigate-user-header {
            height: 4rem;
            width: 4rem;
            border-radius: 2rem;
            box-shadow: 0 0 10px #e8e8e8;
        }

        .navigate-user-name {
            margin-top: 0.4rem;
            padding: 10px;
        }

        .navigate-menus {
            padding: 1rem 0;
        }

        .navigate-menus-item {
            height: 3rem;
        }

        .navigate-menus-item:hover {
            background-color: #33373d;
            color: #e8e8e8;
            cursor: pointer;
        }

        .navigate-menus-item:hover .navigate-menus-item-children {
            display: block;
        }

        .menu-item {
            display: flex;
            height: 3rem;
            background-color: #252a2f;
            position: inherit;
        }

        .menu-item:hover .light-line-left {
            height: 100%;
            animation: height-0-to-100 .2s;
            -webkit-animation: height-0-to-100 .2s; /* Safari 和 Chrome */
        }

        .menu-item:hover .light-line-bottom {
            width: 100%;
            animation: width-0-to-100 .2s;
            -webkit-animation: width-0-to-100 .2s; /* Safari 和 Chrome */
        }

        .navigate-menus-item-children {
            position: relative;
            left: 10rem;
            top: -3rem;
            display: none;
            width: 10rem;
            border-left: 0;
            z-index: 1;
        }

        .content {
            width: calc(100% - 10rem);
            height: 100%;
            border: 0;
            position: fixed;
            left: 10rem;
        }

        .content-top {
            width: 100%;
            height: 2rem;
            line-height: 2rem;
            color: #ffffff;
        }

        .content-top-nav {
            display: flex;
            padding: 0;
            list-style: none;
            height: 100%;
            margin: 0;
        }

        .content-top-nav-item {
            flex: 1 1 auto;
            text-align: center;
            border: 1px solid #e8e8e8;
            border-top: 0;
            cursor: pointer;
            background-color: #252a2f;
        }

        .content-top-nav-item:hover {
            background-color: #7c7c7c;
        }

        .content-top-nav-item.active {
            background-color: #7c7c7c;
        }

        .content-top-nav-item .close {
            float: right;
            line-height: 2rem;
            margin-right: 10px;
            color: #e8e8e8;
            height: 2rem;
            width: 2rem;
            font-size: 1rem;
        }

        .content-top-nav-item .close:hover {
            color: #c60000;
        }

        .content-body {
            width: 100%;
            height: calc(100% - 2rem);
            border: 0;
            display: none;
        }

        .content-body.active {
            display: block;
        }
    </style>
</head>
<body>
<div id="middle" class="main-body">
    <div class="navigate">
        <div class="navigate-user">
            <img id="navigate_user_header" class="navigate-user-header" src="http://img.jwzhu.com/web_25/building/000017的副本.jpg">
            <div id="navigate_user_name" class="navigate-user-name"><span th:text="${admin.nickname}"></span><span onclick="Request.get('/login/logout');" class="margin-left-10" style="cursor: pointer"><i class="fa fa-sign-out"></i></span></div>
        </div>
        <div id="navigate-menus" class="navigate-menus"></div>
    </div>
    <div id="content" class="content">
        <div class="content-top">
            <ul id="content_top_nav" class="content-top-nav"></ul>
        </div>
    </div>
</div>
</body>
<script src="/js/common.js"></script>
<script src="/js/request.js"></script>
<script type="text/javascript">
    window.onload = function () {
        queryMenu();
    };

    let queryMenu = function () {
        Request.get('/queryMenu').then(function (data) {
            data.forEach(function (item) {
                let _firstItemHtml = document.createElement('div');
                _firstItemHtml.classList.add('navigate-menus-item');
                _firstItemHtml.innerHTML = '<div class="menu-item"><div class="light-line-left"></div><div class="margin-auto margin-left-10">' + item.name + '</div></div>';
                document.getElementById('navigate-menus').appendChild(_firstItemHtml);
                if (item.children) {
                    addChildren(_firstItemHtml, item.children);
                }

                bindMenuClick(_firstItemHtml, item);
            });
        });
    };

    let addChildren = function (_first, children) {
        if (children.length === 0) {
            return;
        }

        let _childrenHtml = document.createElement('div');
        _childrenHtml.classList.add('navigate-menus-item-children');
        _first.appendChild(_childrenHtml);

        children.forEach(function (childrenItem) {
            let _childrenItemHtml = document.createElement('div');
            _childrenItemHtml.classList.add('menu-item');
            _childrenItemHtml.innerHTML = '<div class="margin-auto margin-left-10">' + childrenItem.name + '</div><div class="light-line-bottom-div"><div class="light-line-bottom"></div></div>';
            _childrenHtml.appendChild(_childrenItemHtml);
            if (childrenItem.children) {
                addChildren(_childrenItemHtml, childrenItem.children);
            }

            bindMenuClick(_childrenItemHtml, childrenItem);
        });
    };

    let bindMenuClick = function (_itemHtml, item) {
        if (item.type !== 2) {
            return;
        }
        _itemHtml.onclick = function () {
            if (document.querySelectorAll('.content-body').length >= 10) {
                Toast.info('最多打开10个页面');
                return;
            }
            let _activeNav = document.querySelector('.content-top-nav-item.active');
            if (_activeNav) {
                _activeNav.classList.remove('active');
            }
            let _activeContent = document.querySelector('.content-body.active');
            if (_activeContent) {
                _activeContent.classList.remove('active');
            }

            let iFrameId = 'menu_content_' + item.code.replace(/\./g, '_');
            let navItemId = 'content_top_nav_' + item.code.replace(/\./g, '_');
            let _iFrameHtml = document.getElementById(iFrameId);
            let _navItemHtml = document.getElementById(navItemId);

            if (_iFrameHtml) {
                _iFrameHtml.show();
                _navItemHtml.show();
                _iFrameHtml.classList.add('active');
                _navItemHtml.classList.add('active');
            } else {
                document.getElementById('content_top_nav').innerHTML += '<li id="' + navItemId + '" class="content-top-nav-item active" onclick="navClick()" data-iFrameId="' + iFrameId + '">' + item.name + '<div class="close fa fa-times" onclick="navClose()"></div></li>';

                document.getElementById('content').innerHTML += '<iframe id="' + iFrameId + '" class="content-body active" src="' + item.url + '" scrolling="yes"></iframe>';
            }
        };
    };

    let navClick = function () {
        let _target = window.event.target;
        if (_target.classList.contains('active')) {
            return
        }
        let _activeNav = document.querySelector('.content-top-nav-item.active');
        if (_activeNav) {
            _activeNav.classList.remove('active');
        }
        let _activeContent = document.querySelector('.content-body.active');
        if (_activeContent) {
            _activeContent.classList.remove('active');
        }
        _target.classList.add('active');
        let iFrameId = _target.getAttribute('data-iFrameId');
        document.getElementById(iFrameId).classList.add('active');
    };

    let navClose = function () {
        window.event.stopPropagation();
        let _target = window.event.target;
        let _navItemHtml = _target.parentElement;
        let iFrameId = _navItemHtml.getAttribute('data-iFrameId');
        let _iFrameHtml = document.getElementById(iFrameId);
        _navItemHtml.remove();
        _iFrameHtml.remove();

        let nextActiveNavItemSelector = '#' + _navItemHtml.id + '+li';
        let nextActiveNavItemHtml = document.querySelector(nextActiveNavItemSelector);
        nextActiveNavItemHtml = nextActiveNavItemHtml == null ? document.querySelector('#content_top_nav :first-child') : nextActiveNavItemHtml;
        if (nextActiveNavItemHtml != null) {
            let nextActiveIFrameHtml = document.getElementById(nextActiveNavItemHtml.getAttribute('data-iFrameId'));
            nextActiveIFrameHtml.classList.add('active');
            nextActiveNavItemHtml.classList.add('active');
        }
    }

</script>
</html>