<!DOCTYPE html>
<html lang="zh_CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title th:text="${platformName}">管理平台</title>
    <link rel="icon" type="image/x-icon" href="/image/icon.ico">

    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/bootstrap/4.1.3/bootstrap.css">
    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
            position: fixed;
            width: 100%;
            height: 100%;
            background-color: #fbfbfb;
        }

        .top {
            padding: 0 2rem;
            background-color: #252a2f;
            color: #ffffff;
            height: 4rem;
            display: flex;
            font-size: 1.2rem;
        }

        .top-buttons {
            height: 100%;
            font-size: 1.2rem;
        }

        .top-button {
            display: flex;
            height: 100%;
            padding: 0 10px;
            cursor: pointer;
        }

        .top-button:hover {
            background-color: #444a52;
        }

        .middle {
            height: calc(100% - 4rem);
            display: flex;
        }

        .navigate {
            display: inline-block;
            background-color: #252a2f;
            color: #ffffff;
            height: 100%;
            width: 10rem;
        }

        .navigate-user {
            text-align: center;
            border-top: 1px solid #464646;
            border-bottom: 1px solid #464646;
            padding: 2rem 0;
        }

        .navigate-user-header {
            height: 4rem;
            width: 4rem;
            border-radius: 2rem;
            box-shadow: 0 0 10px #ffffff;
        }

        .navigate-user-name {
            margin-top: 0.4rem;
        }

        .navigate-menus {
            padding: 1rem 0;
        }

        .navigate-menus-item {
            height: 3rem;
        }

        .navigate-menus-item:hover {
            background-color: #33373d;
            color: #ffffff;
            cursor: pointer;
        }

        .navigate-menus-item:hover .navigate-menus-item-children {
            display: block;
        }

        .menu-item {
            display: flex;
            height: 3rem;
            background-color: #252a2f;
            position: inherit;
        }

        .light-line-left {
            width: 3px;
            height: 0;
            background-color: #0e90ce;
        }

        .menu-item:hover .light-line-left {
            height: 100%;
            margin: auto 0;
            transition: height .2s;
            -moz-transition: height .2s; /* Firefox 4 */
            -webkit-transition: height .2s; /* Safari 和 Chrome */
            -o-transition: height .2s; /* Opera */
        }

        .light-line-bottom {
            width: 0;
            height: 3px;
            background-color: #0e90ce;
            position: absolute;
            bottom: 0;
        }

        .menu-item:hover .light-line-bottom {
            width: 100%;
            /*margin: auto auto;*/
            transition: width .2s;
            -moz-transition: width .2s; /* Firefox 4 */
            -webkit-transition: width .2s; /* Safari 和 Chrome */
            -o-transition: width .2s; /* Opera */
        }

        .navigate-menus-item-children {
            position: relative;
            left: 10rem;
            top: -3rem;
            display: none;
            width: 10rem;
            border-left: 0;
            z-index: 1;
        }

        .content {
            width: calc(100% - 10rem);
            height: calc(100% - 4rem);
            border: 0;
            position: fixed;
            left: 10rem;
        }

        .content-top {
            width: 100%;
            height: 2rem;
            line-height: 2rem;
        }

        .content-body {
            width: 100%;
            height: calc(100% - 2rem);
            border: 0;
        }

        .content-top-nav {
            display: flex;
            padding: 0;
            list-style: none;
            height: 100%;
            margin: 0;
        }

        .content-top-nav-item {
            flex: 1 1 auto;
            text-align: center;
            border-right: 1px solid #7e8082;
            border-bottom: 1px solid #7e8082;
            cursor: pointer;
            /*background-color: #b7b9bb;*/
            background-color: #464646;
            color: #ffffff;
        }

        .content-top-nav-item:hover {
            background-color: #7c7c7c;
        }

        .content-top-nav-item.active {
            background-color: #7c7c7c;
        }

        .content-top-nav-item.hover .light-line-bottom {
            height: 100%;
            margin: auto 0;
            transition: height .2s;
            -moz-transition: height .2s; /* Firefox 4 */
            -webkit-transition: height .2s; /* Safari 和 Chrome */
            -o-transition: height .2s; /* Opera */
        }

        .content-top-nav-item i {
            float: right;
            line-height: 2rem;
            margin-right: 10px;
            color: #7a0000;
        }

        .content-top-nav-item i:hover {
            color: #c60000;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
<div class="top">
    <div class="margin-auto margin-left-no">
        <i class="fa fa-server"></i>
        <span th:text="${platformName}"></span>
    </div>
    <div class="top-buttons margin-auto margin-right-no">
        <div class="top-button" onclick="Request.get('/login/logout');">
            <span class="margin-auto">
            <i class="fa fa-sign-out"></i>
            <span>退出</span>
        </span>
        </div>
    </div>
</div>
<div id="middle" class="middle">
    <div class="navigate">
        <div class="navigate-user">
            <img id="navigate_user_header" class="navigate-user-header" src="http://img.jwzhu.com/web_25/building/000017的副本.jpg">
            <div id="navigate_user_name" class="navigate-user-name" th:text="${admin.nickname}"></div>
        </div>
        <div id="navigate-menus" class="navigate-menus"></div>
    </div>
    <div id="content" class="content">
        <div class="content-top">
            <ul id="content-top-nav" class="content-top-nav"></ul>
        </div>
    </div>
</div>
</body>
<script src="/js/common.js"></script>
<script src="/js/request.js"></script>
<script type="text/javascript">
    window.onload = function () {
        queryMenu();
    };

    let queryMenu = function () {
        Request.get('/queryMenu').then(function (data) {
            data.forEach(function (item) {
                let _firstItemHtml = document.createElement('div');
                _firstItemHtml.classList.add('navigate-menus-item');
                _firstItemHtml.innerHTML = '<div class="menu-item"><div class="light-line-left"></div><div class="margin-auto margin-left-10">' + item.name + '</div></div>';
                document.getElementById('navigate-menus').appendChild(_firstItemHtml);
                if (item.children) {
                    addChildren(_firstItemHtml, item.children);
                }

                bindMenuClick(_firstItemHtml, item);
            });
        });
    };

    let addChildren = function (_first, children) {
        if (children.length === 0) {
            return;
        }

        let _childrenHtml = document.createElement('div');
        _childrenHtml.classList.add('navigate-menus-item-children');
        _first.appendChild(_childrenHtml);

        children.forEach(function (childrenItem) {
            let _childrenItemHtml = document.createElement('div');
            _childrenItemHtml.classList.add('menu-item');
            _childrenItemHtml.innerHTML = '<div class="margin-auto margin-left-10">' + childrenItem.name + '</div><div class="light-line-bottom"></div>';
            _childrenHtml.appendChild(_childrenItemHtml);
            if (childrenItem.children) {
                addChildren(_childrenItemHtml, childrenItem.children);
            }

            bindMenuClick(_childrenItemHtml, childrenItem);
        });
    };

    let bindMenuClick = function (_itemHtml, item) {
        if (item.type !== 2) {
            return;
        }
        _itemHtml.onclick = function () {
            let _items = document.querySelector('.content-top-nav-item.active');
            if (_items) {
                _items.classList.remove('active');
            }
            let iFrameId = 'menu_content_' + item.code.replace(/\./g, '_');
            let navItemId = 'content-top-nav_' + item.code.replace(/\./g, '_');
            if (document.getElementById(iFrameId)) {
                document.getElementById(navItemId).classList.add('active');
            } else {
                let _iFrameHtml = document.createElement('iframe');
                _iFrameHtml.id = iFrameId;
                _iFrameHtml.classList.add('content-body');
                _iFrameHtml.src = item.url;
                document.getElementById('content').appendChild(_iFrameHtml);
                let _navItemHtml = document.createElement('li');
                _navItemHtml.id = navItemId;
                _navItemHtml.setAttribute('data-iFrameId', iFrameId);
                _navItemHtml.classList.add('content-top-nav-item', 'active');
                _navItemHtml.innerHTML = item.name + '<i class="fa fa-times"></i>';
                document.getElementById('content-top-nav').appendChild(_navItemHtml);
                _navItemHtml.onclick = navClick;
            }
        };
    };

    let navClick = function(){
        if(!this.classList.contains('active')){
            let _items = document.querySelector('.content-top-nav-item.active');
            if (_items) {
                _items.classList.remove('active');
            }
            this.classList.add('active');
        }
    };

</script>
</html>